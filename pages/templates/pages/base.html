<!-- templates/pages/base.html -->
{% load static %}
<!DOCTYPE html>
<html lang="ko">
<style>
/* nav 관련으로 base.html에서만 사용 */
nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 10px; 
}
nav ul li {
    position: relative;
}
nav ul li a {
    text-decoration: none;
    color: var(--Header-Footer-Font-Color);
    padding: 5px 10px;
    display: block;
}
nav ul li ul.submenu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background-color: var(--Header-Footer-Background-Color);
    padding: 10px 0;
    border-radius: 4px;
    box-shadow: 0 2px 5px var(--black-shadow); 
    min-width: 180px;
    z-index: 100;
}
nav ul li:hover > ul.submenu {
    display: block;
}
nav ul li a.active {
    border-bottom: 2px solid var(--primary-50); /* 원하는 색상 */
    font-weight: 600; /* 강조 */
}

/* 메뉴 + 서브 메뉴 공통 폰트 */
nav ul li a,
nav ul li .submenu-panel .submenu-list ul li a {
    font-family: 'Pretendard', 'Noto Sans KR', sans-serif; /* 원하는 폰트 */
    font-size: 16px;       /* 원하는 크기 */
    font-weight: 500;      /* 원하는 굵기 */
    color: var(--Header-Footer-Font-Color);
    text-decoration: none;
}

/* 기본 메뉴 패널 숨김 */
nav ul li .submenu-panel {
    display: none;  /* 기본 숨김 */
    position: absolute;
    top: 100%;
    left: 0;
    background-color: var(--Header-Footer-Background-Color);
    padding: 20px;
    border-radius: 4px;
    box-shadow: 0 2px 5px var(--black-shadow);
    z-index: 100;
    min-width: 700px;           /* 패널 기본 가로 크기, 조절 필요하면 늘리기 */
    flex-direction: row;
    flex-wrap: nowrap;   /* ← 여기 추가 */
    gap: 20px;
    align-items: flex-start;
}

/* hover 시 패널 표시 */
nav ul li:hover .submenu-panel {
    display: flex;
}

/* 좌측 설명 영역 */
nav ul li .submenu-panel .menu-desc {
    flex: 1;                    
    color: #fff;               /* 글자 흰색으로 변경 */
    font-size: 14px;
    padding-right: 20px;
    border-right: 1px solid #eee;
    display: flex;             /* flex로 세로 중앙 정렬 가능 */
    align-items: flex-start;   /* 위쪽 기준 정렬 */
    height: 100%;              /* 패널 전체 높이 차지 */
}

/* 우측 메뉴 리스트 영역 - 세로 정렬 */
nav ul li .submenu-panel .submenu-list {
    flex: 2;                    
    display: flex;
    flex-direction: row;     /* 가로 정렬 */
    gap: 20px;               /* 항목 사이 간격 */
}

/* 우측 메뉴 리스트 항목 */
nav ul li .submenu-panel .submenu-list ul {
    display: flex;
    flex-direction: column;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 10px;
}

nav ul li .submenu-panel .submenu-list ul li {
    padding: 0;              /* 위/아래 패딩 제거 */
    border-bottom: none;     /* 가로 정렬이면 아래 경계선 제거 */
}

nav ul li .submenu-panel .submenu-list ul li a {
    text-decoration: none;
    color: var(--Header-Footer-Font-Color);
    font-weight: 500;
    white-space: nowrap;  /* ← 추가 */
}

/* small 태그 배경 흰색 + 살짝 패딩 */
nav ul li .submenu-panel small {
    color: #c0c6cc;       /* 회색 계열, 필요하면 다른 색으로 조정 가능 */
    font-weight: 400;     /* 필요 시 굵기 조정 */
}

.btn-comp {
    display: flex;
    align-items: center;
    gap: 8px; /* 이미지와 글자 간격 */
}

.logo-img {
    height: 32px;     /* 핵심 */
    width: auto;      /* 비율 유지 */
}

</style>

<head>
    <meta name="google-site-verification" content="g1-AlUGL51Tc1WvulUO4XAGGJNN_pfW0CnOhkmVT-Cs" />
    <meta charset="UTF-8" />
    <title>{% block title %}홈페이지{% endblock %}</title>
   
    <link rel="icon" href="{% static 'favicon.ico' %}">

    <link rel="stylesheet" href="{% static 'css/colors.css' %}">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}">
    <link rel="stylesheet" href="{% static 'css/sub_modal.css' %}">
    <link rel="stylesheet" href="{% static 'css/sub_selectsearch.css' %}">
</head>
<body style="margin: 0; padding: 0;">
<header style="position: fixed; top: 0; left: 0; right: 0; z-index: 10;">
    <div class="header-div-menu">
        <a class="btn-comp" href="{% url 'home' %}">
            {% if request.session.user and request.session.user.tenanticonurl %}
                <img src="{{ request.session.user.tenanticonurl }}"
                    class="logo-img"
                    alt="기업 로고">
            {% else %}
                <img src="{% static 'images/GenQuery.svg' %}"
                    class="logo-img"
                    alt="GenQuery 로고">
            {% endif %}
           <span class="logo">GenQuery</span>
        </a>

        
        <nav>
            <ul>
                <li>
                    <a href="/service_view/"
                       class="{% if '/service_view/' in request.path %}active{% endif %}">
                        서비스 소개
                    </a>
                </li>

                <li>
                    <a href="/about_view/"
                       class="{% if '/about_view/' in request.path %}active{% endif %}">
                        기능 소개
                    </a>
                </li>
                <li>
                    <a href="/usage/"
                       class="{% if '/usage/' in request.path %}active{% endif %}">
                        서비스 이용
                    </a>
                </li>
                {% if request.session.user %}

                    {% if request.session.user.sampledocyn == 'Y' or request.session.user.projectmanager == 'Y' %}
                    <li>
                        <a href="#"
                        class="{% if '/master/servers/' in request.path or '/master/tables/' in request.path or '/master/columns/' in request.path %}active{% endif %}">
                            기준 정보 &#9663;
                        </a>
                        <div class="submenu-panel">
                            <div class="menu-desc">
                                    문서, 챕터, 항목, 데이터 등 문서를 작성하기 위한 기준 정보를 관리합니다.<br><br>
                                    문서 : 문서의 기준 관리<br>
                                    &nbsp└ 챕터 : 챕터 구성 템플릿 관리<br>
                                    &nbsp&nbsp&nbsp└ 항목 : 문장, 표, 차트 구성
                            </div>
                            <div class="submenu-list">
                                <ul>
                                    <li><a href="/master/servers/">서버 관리 <br>&nbsp&nbsp&nbsp&nbsp: <small>서버 관리</small></a></li>
                                    <li><a href="/master/tables/">테이블 관리 <br>&nbsp&nbsp&nbsp&nbsp: <small>테이블 관리</small></a></li>
                                    <li><a href="/master/columns/">컬럼 관리 <br>&nbsp&nbsp&nbsp&nbsp: <small>컬럼 관리 </small> </a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    {% endif %}
                    
                    {% if request.session.user.billingmodelcd != 'Fr' and request.session.user.billingmodelcd != 'Pr' %}
                        {% if request.session.user.tenantmanager == 'Y' or request.session.user.projectmanager == 'Y' %}
                        <li>
                            <a href="#"
                            class="{% if '/master/tenant_users/' in request.path or '/master/projects/' in request.path or '/master/project_users/' in request.path or '/master/tenant_llms/' in request.path %}active{% endif %}">
                                프로젝트 관리 &#9663;
                            </a>
                            <div class="submenu-panel">
                                <div class="menu-desc">
                                    기업 사용자와 기업 LLM을 포함한 프로젝트 전반의 정보 및 프로젝트별 사용자 구성을 관리합니다.
                                </div>
                                <div class="submenu-list">
                                    <ul>
                                        {% if request.session.user.tenantmanager == 'Y' %}
                                            <li><a href="/master/tenant_users/">기업 사용자 관리</a></li>
                                            {% if request.session.user.roleid == 7 %}<li><a href="/master/tenant_llms/">기업 LLM 관리</a></li>{% endif %}
                                            <li><a href="/master/projects/">프로젝트 관리</a></li>
                                        {% endif %}
                                        {% if request.session.user.tenantmanager == 'Y' or request.session.user.projectmanager == 'Y' %}
                                            <li><a href="/master/project_users/">프로젝트 사용자 관리</a></li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </li>
                        {% endif %}

                    {% endif %}

                    {% if request.session.user.roleid == 7 %}
                        <li>
                            <a href="#"
                            class="{% if '/master/user_role/' in request.path or '/master/tenants/' in request.path or '/master/llms/' in request.path or '/master/llmapis/' in request.path or '/master/tenant_request_list/' in request.path or '/master/help/' in request.path %}active{% endif %}">
                                기업관리 &#9663;
                            </a>

                            <div class="submenu-panel">
                                <div class="menu-desc">
                                    관리자용 메뉴 (System Admin)<br>
                                    사용자 관리(기본) 에서 관리자/일반유저 설정 가능
                                </div>
                                <div class="submenu-list">
                                    <ul>
                                        <li><a href="/master/user_role/">사용자 관리(기본)</a></li>
                                        <li><a href="/master/tenants/">기업 관리</a></li>
                                        <li><a href="/master/llms/">LLM 관리</a></li>
                                        <li><a href="/master/llmapis/">LLM API 관리</a></li>
                                        <li><a href="/master/tenant_request_list/">기업 생성 요청 관리</a></li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    {% endif %}
                {% endif %}
            </ul>
        </nav>

    </div>
    <div style="margin-right: 20px;">
        {% if request.session.user %}
        <div style="display: flex; align-items: center; gap: 5px;">
            <!-- 이메일/홈 이동 -->
            <a href="{% url 'myinfo' %}" style="display: flex; align-items: center; gap: 8px; text-decoration: none;">
                <span style="color: var(--Header-Footer-Font-Color); font-weight: 500;">
                    {{ request.session.user.email }}&nbsp;&nbsp;
                </span>
            </a>

            <!-- 로그아웃 -->
            <a href="{% url 'logout' %}" class="btn btn-danger" style="color: var(--border-color);text-decoration: none;
            ">로그아웃</a>
        </div>
        {% else %}
        <!-- 회원가입 / 로그인 -->
        <a onclick="show_signup_base_modal()" style="
            background-color: var(--primary-500);
            color: var(--border-color);
            padding: 6px 12px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 14px;
            margin-right: 8px;
            cursor: pointer;
        ">회원가입</a>
        <a onclick="show_login_base_modal('')" style="
            background-color: var(--info-color);
            color: var(--border-color);
            padding: 6px 12px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
        ">로그인</a>
        {% endif %}
    </div>
</header>

<main style="padding-top: 70px; padding-bottom: 50px; height: calc(100vh - 120px); overflow-y: auto;">
    {% block content %}{% endblock %}
</main>

<footer style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 10;">
    <div>
        © GenQuery 2025. All rights reserved.<br>
    </div>
</footer>

<!-- 모달 오버레이 -->
{% include "pages/modal_verified.html" %}
{% include "pages/modal_register.html" %}
{% include "pages/modal_login.html" %}

<script>
let flag = '';
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
const csrftoken = getCookie('csrftoken');

function handleLoginSuccess(userData) {
    document.getElementById("login_base_modal").style.display = "none";
    alert("로그인이 완료되었습니다.");
    location.reload();
}

window.addEventListener("load", function () {
    const code = '{{code}}';
    const txt = '{{text}}';
    const page = '{{page}}';
    if (code === 'login'){
        alert("해당 페이지는 로그인이 필요합니다.\n로그인 후 다시 접속 부탁드립니다.");
        show_login_base_modal(page);
    }
});
</script>
</body>
</html>
